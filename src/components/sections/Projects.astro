---
// Importamos Image y los tipos de Astro
import { Image } from "astro:assets";
import type { CollectionEntry } from "astro:content";
import { getCollection } from "astro:content";
import ExternalLinkIcon from "@components/icons/ExternalLinkIcon.astro";

// Obtenemos los proyectos
const projects: CollectionEntry<"projects">[] = await getCollection("projects");
---

<section id="projects" class="py-16 text-gray-800 dark:text-slate-300">
  <div class="max-w-6xl mx-auto px-6">
    <div class="mb-12">
      <h2 class="text-4xl font-bold text-gray-900 dark:text-slate-100 mb-4">
        Proyectos
      </h2>
      <p class="text-lg text-gray-600 dark:text-slate-400">
        Mis proyectos más emocionantes y creativos. Cada proyecto es el
        resultado de mi dedicación y pasión por la programación...
      </p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-stretch">
      {
        projects.map((project) => {
          const isFullstack = !!project.data.backend;
          const tag = isFullstack ? "Fullstack" : "Frontend";

          const tagClass = isFullstack
            ? "bg-indigo-100 text-indigo-700 dark:bg-indigo-500/20 dark:text-indigo-300"
            : "bg-emerald-100 text-emerald-700 dark:bg-emerald-500/20 dark:text-emerald-300";

          const feTechs =
            project.data.frontend.technologies
              ?.split(",")
              .map((t) => t.trim()) || [];
          const beTechs =
            project.data.backend?.technologies
              ?.split(",")
              .map((t) => t.trim()) || [];
          const allTechs = [...feTechs, ...beTechs];

          return (
            <article class="p-5 md:p-6 rounded-xl bg-white dark:bg-slate-800 shadow-lg flex flex-col h-full border border-gray-200 dark:border-transparent hover:border-indigo-500/30 transition-all duration-300">
              <span
                class={`text-xs font-semibold rounded-full px-3 py-1 self-start mb-4 ${tagClass}`}
              >
                {tag}
              </span>
              {project.data.frontend.screenshot && (
                <a
                  href={project.data.frontend.demo}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="block mb-5"
                >
                  <div class="rounded-lg overflow-hidden shadow-md">
                    <Image
                      src={project.data.frontend.screenshot}
                      alt={`Captura de ${project.data.title}`}
                      width={800}
                      height={450}
                      format="webp"
                      class="w-full h-auto aspect-[16/10] object-cover object-top transition-transform duration-300 hover:scale-105"
                      loading="lazy"
                    />
                  </div>
                </a>
              )}
              <header>
                <h3 class="text-2xl font-bold text-gray-900 dark:text-slate-100 mb-3">
                  {project.data.title}
                </h3>
              </header>
              <p class="text-gray-600 dark:text-slate-300 text-sm mb-6 flex-grow">
                {project.data.description}
              </p>
              <a
                href={project.data.frontend.demo}
                target="_blank"
                rel="noopener noreferrer"
                class="inline-flex items-center gap-2 px-4 py-2 
         bg-gray-100 dark:bg-gray-800 
         border border-gray-300 dark:border-gray-700 
         rounded-full text-sm font-medium 
         text-gray-700 dark:text-gray-300 
         hover:bg-gray-200 dark:hover:bg-gray-700 
         transition-all"
              >
                <ExternalLinkIcon class="w-4 h-4" />
                <span>Ver código</span>
              </a>
              <footer class="flex flex-wrap gap-2">
                {allTechs.map((tech) => (
                  <span class="text-xs bg-gray-200 text-gray-700 dark:bg-slate-700 dark:text-slate-300 px-3 py-1 rounded-md font-medium">
                    {tech}
                  </span>
                ))}
              </footer>
            </article>
          );
        })
      }

      <a
        href="https://github.com/SergioIzq"
        target="_blank"
        rel="noopener noreferrer"
        class="p-5 md:p-6 rounded-xl bg-white dark:bg-slate-800 shadow-lg flex flex-col h-full
               border border-gray-200 dark:border-transparent hover:border-indigo-500/30 transition-all duration-300
               justify-center items-center text-center group"
      >
        <h3
          class="text-2xl font-bold text-gray-900 dark:text-slate-100 group-hover:text-indigo-500 dark:group-hover:text-indigo-300 transition-colors duration-300"
        >
          Ver más proyectos
        </h3>
        <span
          class="text-gray-600 dark:text-slate-400 group-hover:text-indigo-500 dark:group-hover:text-indigo-300 transition-colors duration-300 mt-2 text-lg"
        >
          en GitHub &rarr;
        </span>
      </a>
    </div>
  </div>
</section>
